#################################################################
# Step 1 - retrieve similar episode
#################################################################
sp {retrieve*similar*episode
   (state <s> ^name predict-mario-position
              ^mario <m>
              ^stage 1
              ^epmem.command <ecom>
              ^last-id <lid>)
    (<m> ^sx <sx>
        ^sy <sy>
        ^type <mtype>
        ^top-right.isblocked <i1>
        ^top-left.isblocked <i2>
        ^top.isblocked <i3>
        ^left.isblocked <i4>
        ^right.isblocked <i5>
        ^bottom-right.isblocked <i6>
        ^bottom-left.isblocked <i7>
        ^bottom.isblocked <i8>)
-->
    (<ecom> ^query <q>
           ^before <lid>)
    (<q> ^name mario-soar
        ^monster <em>)
    (<em> ^sx <sx>
        ^sy <sy>
        ^type <mtype>
        ^top-right.isblocked <i1>
        ^top-left.isblocked <i2>
        ^top.isblocked <i3>
        ^left.isblocked <i4>
        ^right.isblocked <i5>
        ^bottom-right.isblocked <i6>
        ^bottom-left.isblocked <i7>
        ^bottom.isblocked <i8>)
}

sp {propose*store*retrieved*episode
   (state <s> ^name predict-next-position
              ^epmem.result <eres>
              ^epmem.command <ecomm>
              ^monster <m>
              ^stage 1)
   (<eres> ^success <query>
           ^retrieved <episode>
           ^memory-id <id>
           ^normalized-match-score 1.0)
   (<ecomm> ^query <query>)
-->
    (<s> ^operator <op> +)
   (<op> ^name store-information-similar-episode
         ^episode <episode>
         ^monster <m>
         ^id <id>)
}


#need to think about partial matches 
#for now just reject these partial matches 
sp {apply*store*information*retrieved*episode
   (state <s> ^name predict-next-position
              ^operator <op>
              ^superstate <ss>)
   (<ss> ^name tackle-monster)
   (<op> ^name store-information-similar-episode
         ^episode <episode>
         ^monster <m>
         ^id <id>)
   (<m> ^prediction <p>
        ^sx <sx>
        ^sy <sy>
        ^type <mtype>
        ^top-right.isblocked <i1>
        ^top-left.isblocked <i2>
        ^top.isblocked <i3>
        ^left.isblocked <i4>
        ^right.isblocked <i5>
        ^bottom-right.isblocked <i6>
        ^bottom-left.isblocked <i7>
        ^bottom.isblocked <i8>)
   (<episode> ^monster <em>)
   (<em> ^sx <sx>
        ^sy <sy>
        ^xd <ex>
        ^yd <ey>
        ^type <mtype>
        ^top-right.isblocked <i1>
        ^top-left.isblocked <i2>
        ^top.isblocked <i3>
        ^left.isblocked <i4>
        ^right.isblocked <i5>
        ^bottom-right.isblocked <i6>
        ^bottom-left.isblocked <i7>
        ^bottom.isblocked <i8>)
-->
   (<p> ^position <pp>)
   (<pp> ^memory-id <id>
         ^next-id (+ <id> 1)
         ^xd <ex>
         ^yd <ey>)
   (<s> ^stage 1 -
        ^stage 2)
}



#sp {apply*retrieve*similar*episode
#   (state <s> ^name predict-next-position
#              ^epmem.command <ecom>
#              ^operator <op>
#              ^last-id <lid>)
#   (<op> ^name retrieve-similar-episode
#         ^monster <m>)
#   (<m> ^sx <sx>
#        ^sy <sy>
#        ^type <mtype>
#        ^top-right.isblocked <i1>
#        ^top-left.isblocked <i2>
#        ^top.isblocked <i3>
#        ^left.isblocked <i4>
#        ^right.isblocked <i5>
#        ^bottom-right.isblocked <i6>
#        ^bottom-left.isblocked <i7>
#        ^bottom.isblocked <i8>)
#-->
#   (<ecom> ^query <q>
#           ^before <lid>)
#   (<q> ^name mario-soar
#        ^monster <em>)
#   (<em> ^sx <sx>
#        ^sy <sy>
#        ^type <mtype>
#        ^top-right.isblocked <i1>
#        ^top-left.isblocked <i2>
#        ^top.isblocked <i3>
#        ^left.isblocked <i4>
#        ^right.isblocked <i5>
#        ^bottom-right.isblocked <i6>
#        ^bottom-left.isblocked <i7>
#        ^bottom.isblocked <i8>)
#   (<s> ^stage 1 -
#        ^stage 2)
#}
