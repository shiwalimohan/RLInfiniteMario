sp {mario*elaborate*pipe
   (state <s> ^io.input-link.visual-scene <v>
              ^metadata <m>
              ^name mario-soar-hrl3)
   (<v> ^tile-row <row>)
   (<row> ^y <y>
          ^tile <t>)
   (<t> ^x <xloc>
        ^type |\||)
--> 
(<m> ^pipe-tile <p>)
   (<p> ^xleft (- <xloc> 1)
        ^xloc <xloc>
        ^yloc <y>
        ^yup  (+ <y> 1))
}
sp {mario*elaborate*pipe1
   (state <s> ^metadata <m> 
              ^io.input-link.visual-scene <v>
              ^name mario-soar-hrl3)
   (<m> ^pipe-tile <p>)
   (<v> ^tile-row <row1>
        ^tile-row <row2>)
   (<p> ^xleft <xleft>
        ^yup <yup>
        ^xloc <x>
        ^yloc <y>)
   (<row1> ^y <y>
           ^tile <tile1>)
   (<tile1> ^x <xleft>
            ^type | |)
   (<row2> ^y <yup>
           ^tile <tile2>)
   (<tile2> ^x <x>
            ^type | |)
-->
   (<s> ^pipe <pipe>)
   (<pipe> ^xloc <x>
        ^yloc <y>)
}
sp {mario*elaborate*pipe2
   (state <s> ^pipe <pipe>
              ^mario <mario>
              ^name mario-soar-hrl3)
   (<mario> ^xi <x>
            ^yi <y>
            ^tile-below-dist <td1>
          - ^tile-below-no <td1>)
   (<pipe> ^xloc <px>
           ^yloc <py>)
-->
   (<pipe> ^distx (- <px> <x>)
        ^height (- <py> <td1>))
}
sp {mario*elaborate*pipe3
   (state <s> ^pipe <pipe>
              ^name mario-soar-hrl3)
   (<pipe> ^distx < 4
             ^distx >= 0)
   
-->
   (<pipe> ^isreachable yes)
}