sp {mario*elaborate*pipe
   (state <s> ^io.input-link.visual-scene <v>
              ^metadata <m>
              ^name mario-soar-hrl)
   (<v> ^tile-row <row>)
   (<row> ^y <y>
          ^tile <t>)
   (<t> ^x <xloc>
        ^type |\||)
--> 
(<m> ^pipe-tile <p>)
   (<p> ^xleft (- <xloc> 1)
        ^xloc <xloc>
        ^yloc <y>
        ^yup  (+ <y> 1))
}
sp {mario*elaborate*pipe1
   (state <s> ^metadata <m> 
              ^io.input-link.visual-scene <v>
              ^name mario-soar-hrl)
   (<m> ^pipe-tile <p>)
   (<v> ^tile-row <row1>
        ^tile-row <row2>)
   (<p> ^xleft <xleft>
        ^yup <yup>
        ^xloc <x>
        ^yloc <y>)
   (<row1> ^y <y>
           ^tile <tile1>)
   (<tile1> ^x <xleft>
            ^type | |)
   (<row2> ^y <yup>
           ^tile <tile2>)
   (<tile2> ^x <x>
            ^type | |)
-->
   (<s> ^pipe <pipe>)
   (<pipe> ^xloc <x>
        ^yloc <y>)
}
sp {mario*elaborate*pipe2
   (state <s> ^pipe <pipe>
              ^mario <mario>
              ^name mario-soar-hrl)
   (<mario> ^xi <x>
            ^yi <y>)
   (<pipe> ^xloc <px>
           ^yloc <py>)
-->
   (<pipe> ^distx (- <px> <x>)
        ^height (- <py> <y>))
}
sp {mario*elaborate*pit
   (state <s> ^io.input-link.visual-scene <v>
              ^metadata <m>
              ^name mario-soar-hrl)
   (<v> ^tile-row <row>)
   (<row> ^y 0
          ^tile <t>)
   (<t> ^x <xloc>
        ^type | |)
--> 
   (<m> ^pit-tile <p>)
   (<p> ^xleft (- <xloc> 1)
        ^xright (+ <xloc> 1)
        ^x <xloc>)
}
sp {mario*elaborate*pit1
   (state <s> ^io.input-link.visual-scene <v>
              ^metadata <m>
              ^name mario-soar-hrl)
   (<m> ^pit-tile <pt>)
   (<pt> ^x <xloc>)
   (<v> ^tile-row <row1>)
   (<row1> ^tile <tile>)
   (<tile> ^x <xloc>
           ^type |7|)
-->
   (<pt> ^true no)
}
sp {mario*elaborate*pit3
   (state <s> ^metadata <m>
              ^io.input-link.visual-scene <v>
              ^name mario-soar-hrl)
   (<m> ^pit-tile <p>)
   (<p> ^xleft <xleft>
        ^x <xloc>
      - ^true no)
   (<v> ^tile-row <row>)
   (<row> ^y 0
          ^tile <tile>)
   (<tile> ^x <xleft>
           ^type |7|)
-->
   (<m> ^pit <pit>)
   (<pit> ^start (+ <xleft> 1))
}
sp {mario*elaborate*pit4
   (state <s> ^metadata <m> 
              ^io.input-link.visual-scene <v>
              ^name mario-soar-hrl)
   (<m> ^pit-tile <p>
        ^pit <pit>)
   (<p> ^xright <xright>
       - ^true no )
   (<v> ^tile-row <row>)
   (<row> ^y 0
          ^tile <tile>)
   (<tile> ^x <xright>
           ^type |7|)
   (<pit> ^start <sp> < <xright>)
-->
   (<s> ^pit <spit>)
   (<spit> ^end (- <xright> 1)
           ^start <sp>)
}
sp {mario*elaborate*platform
   (state <s> ^io.input-link.visual-scene <v>
              ^metadata <m>
              ^name mario-soar-hrl)
   (<v> ^tile-row <row>)
   (<row> ^y <yloc>
          ^tile <t>)
   (<t> ^x <xloc>
        ^type |1|)
--> 
   (<m> ^platform-tile <p>)
   (<p> ^xleft (- <xloc> 1)
        ^xright (+ <xloc> 1)
        ^x <xloc>
        ^y <yloc>)
}
sp {mario*elaborate*platform1
   (state <s> ^io.input-link.visual-scene <v>
              ^metadata <m>
              ^name mario-soar-hrl)
   (<m> ^platform-tile <pt>)
   (<pt> ^xleft <xleft>
         ^y <yloc>
         ^x <xloc>)
   (<v> ^tile-row <row1>)
   (<row1> ^tile <tile>
           ^y <yloc>)
   (<tile> ^x <xleft>
           ^type | |)
-->
   (<m> ^platform <p>)
   (<p> ^start <xloc>
        ^y <yloc>)
}
sp {mario*elaborate*platform2
   (state <s> ^io.input-link.visual-scene <v>
              ^metadata <m>
              ^name mario-soar-hrl)
   (<m> ^platform-tile <pt>
        ^platform <p>)
   (<pt> ^xright <xright>
         ^y <yloc>
         ^x <xloc>)
   (<v> ^tile-row <row1>)
   (<row1> ^tile <tile>
           ^y <yloc>)
   (<tile> ^x <xright>
           ^type | |)
   (<p> ^y <yloc>
        ^start <sp> < <xright>)
-->
   (<s> ^platform <pp>)
   (<pp> ^end <xloc>
        ^y <yloc>
        ^start <sp>)
}
sp {mario*elaborate*platform*3
   (state <s> ^name mario-soar-hrl
              ^platform <p>
              ^mario <mario>)
   (<mario> ^xi <mariox>
            ^yi <marioy>)
   (<p> ^start <start>
        ^end <end>
        ^y <yloc>)
-->
   (<p> ^disty (- <yloc> <marioy>)
        ^dist-start (- <start> <mariox>)
        ^dist-end (- <end> <mariox>))
}
sp {mario*elaborate*platform4
   (state <s> ^name mario-soar-hrl
              ^platform <p>)
   (<p> ^disty < 3
        ^dist-start < 4
        ^dist-end > -3)

-->
   (<p> ^isreachable yes)
}
sp {mario*elaborate*platform5
   (state <s> ^name mario-soar-hrl
              ^platform <p>)
   (<p> ^y <yloc>)
-->
   (<p> ^distyup (+ <yloc> 1))
}

